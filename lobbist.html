<html lang="en" dir="ltr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>EU Integrity Watch</title>
<link rel="shortcut icon" href="favicon.ico">
<link href="css/bower.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="css/dc.css"/>
<link rel="stylesheet" type="text/css" href="css/style.css"/>


<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the pdate via file:// -->
<!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<script type="text/javascript" src="js/bower.js"></script>

<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@TI_EU" />
<meta name="twitter:creator" content="@eucampaign" />

<meta property="og:url" content="http://www.integritywatch.eu" />
<meta property="og:title" content="EU Integrity Watch: monitor potential conflicts of interests" />
<meta property="og:description" content="Interactive database that provides a unique overview of the activities and outside income for the members of the European Parliament and Commission" />
<meta property="og:imdate" content="http://www.integritywatch.eu/img/thumbnail.jpg" />

</head>
<body>


<script>
$( document ).ready(function() {
	$('#view_charts').click(function(ev) {
		ev.preventDefault();
		$('#hidden_charts_wrap').slideToggle('slow', function () {
			changeLinkStatus();
		})
	})
	
	function changeLinkStatus() {
		if($('#hidden_charts_wrap').css('display') == 'none'){
			$('#view_charts').text('VIEW ALL THE CHARTS')
		}else {
			$('#view_charts').text('HIDE CHARTS')
		}
		$('#view_charts').toggleClass('hiddencharts');
	}
	
	$('#collapse_about a').click(function(ev) {
		ev.preventDefault();
		$('#collapse_about a').toggleClass('opened');
		$('#collapse_about a').toggleClass('closed');
		$('#about_wrap').slideToggle('slow', function () {
			$('#about_wrap_top').slideToggle('fast')
		})
		
	})
	
	$('.info').click(function(ev) {
		ev.preventDefault();
		if($(this).hasClass('opened')){
			$(this).removeClass('opened');
			$(this).parents('.info_chart').find('p.desc').slideUp('fast')
		}else{
			closeAllInfos();
			$(this).addClass('opened');
			$(this).parents('.info_chart').find('p.desc').slideDown('fast')
		}
	});
	
	function closeAllInfos() {
		$('.info').removeClass('opened');
		$('p.desc').slideUp('fast');
	}
	
});

var detailtpl = sidetpl = null ;
var datatable = null;
var rep = null;

var representatives = events = [];
var ridx ={};

function grid (selector,data) {

	var ndx = crossfilter(data),
			all = ndx.groupAll();

	var color = d3.scale.linear()
				.clamp(true)
				.domain([0,1, 70])
				.range(["white","#ffc7b6", "#f85631"])
				.interpolate(d3.interpolateHcl);

var mainCategories = {"1":"Consultants","2":"Corporate","3":"NGOs","4":"Think tanks ","5":"Churches ","6":"Municipal"};

var subCategories = {"11":"Professional consultancies","12":"Law firms","13":"Self-employed consultants","21":"Companies & groups","22":"Trade and business associations","23":"Trade unions","24":"Other organisations","31":"Non-governmental organisations, platforms and networks and similar","41":"Think tanks and research institutions","42":"Academic institutions","51":"Organisations representing churches and religious communities","61":"Local, regional and municipal authorities (at sub-national level)","62":"Other public or mixed entities, etc.","444":"Trade unions and professional associations","446":"Trade unions and professional associations","450":"Regional structures","458":"Other public or mixed entities, created by law whose purpose is to act in the public interest","466":"Trade unions and professional associations","469":"Trade unions and professional associations","477":"Other public or mixed entities, created by law whose purpose is to act in the public interest","480":"Trade unions and professional associations","501":"Trade unions and professional associations","504":"Other public or mixed entities, created by law whose purpose is to act in the public interest","506":"Trade unions and professional associations","508":"Trade unions and professional associations","5055":"Trade unions and professional associations","5060":"Trade unions and professional associations","5062":"Other public or mixed entities, created by law whose purpose is to act in the public interest","5065":"Trade unions and professional associations","5073":"Trade unions and professional associations","5074":"Regional structures","5075":"Trade unions and professional associations","5085":"Regional structures","5087":"Trade unions and professional associations","5089":"Trade unions and professional associations","5095":"Trade unions and professional associations","5099":"Transnational associations and networks of public regional or other sub-national authorities","5105":"Trade unions and professional associations","5110":"Trade unions and professional associations","5115":"Trade unions and professional associations","5130":"Trade unions and professional associations","5133":"Regional structures","5141":"Other public or mixed entities, created by law whose purpose is to act in the public interest","5157":"Transnational associations and networks of public regional or other sub-national authorities","5159":"Trade unions and professional associations","5171":"Trade unions and professional associations","5172":"Other public or mixed entities, created by law whose purpose is to act in the public interest","5197":"Regional structures","5205":"Trade unions and professional associations","5226":"Trade unions and professional associations","5227":"Trade unions and professional associations","5230":"Trade unions and professional associations","5256":"Trade unions and professional associations","5262":"Regional structures","5356":"Trade unions and professional associations","5371":"Trade unions and professional associations","5374":"Trade unions and professional associations","5390":"Regional structures","5400":"Trade unions and professional associations"};



	rep = ndx.dimension(function(d) {
      return d.acronym.toLowerCase()+ " " + d.name.toLowerCase()+ " ";
	});

	drawTable();
	drawMainCategory();
	drawSector();
	drawExpense();
	drawNbMeetings();
	drawNbLobbyists();
  	drawNbBadges();
  	drawCounter();
	drawCountry();
/*	drawDate();
	drawMeetings();
	drawWeekDay();
	drawHost();
	drawHostType();
	drawRange();
*/

	function rotateBarChartLabels(chart) {
		chart.svg().selectAll('.axis.x text')
			.style("text-anchor", "end" )
			.attr("transform", function(d) { return "rotate(-45, -4, 9) "; });

	}

  function drawCounter (){
		var dim = ndx.dimension (function(d) {
      return d.id;
		});

    var group   = dim.group().reduce(
      function(p,d) {  
        p.nb +=1;
        p.fte = +d.fte;
        p.accredited = +d.accredited;
        p.cost = +getCost(d);
        return p;
      },
      function(p,d) {  
        p.nb -=1;
        p.fte = d.fte;
        p.accredited = +d.accredited;
        p.cost = +getCost(d);
        return p;
      },
      function(p,d) {  
        return {nb:0,fte:0,accredited:0,cost:0}; 
      }
    );

    group.order (function(p){return p.nb});
    var fte=0;
    var cost=0;
    var accredited=0;
  	var count = dc.dataCount(".org-count")
		.dimension(group)
		.group({value: function() {
			return group.all().filter(function(kv) {
        if (kv.value.nb >0) {
          fte += +kv.value.fte;
          accredited += +kv.value.accredited;
          cost += +kv.value.cost;
        }

				return kv.value.nb>0; 
			}).length;
		}})
		.on ("renderlet.count",function (chart) {
        $(".nbfte").html(fte);
        $(".nbaccredited").html(accredited);
        $(".nbcost").html(cost);
        cost=0;
        fte=0;
        accredited=0;
        console.log ("display counter");
    })
	  .on("renderlet.resetall", function(c) {
			var total=c.dimension().size();
			var filtered= c.group().value();
			var disabled= (total == filtered);

      RefreshTable();

			$(".resetall").attr("disabled",disabled);
			ga && ga('send', 'event', 'filter', 'subset', filtered);

			if (filtered >=0) {
				var one2one=0;
//				eventgroup.all().forEach(function(d) { if(d.value ==1) one2one ++;});
//				var ratio=Math.round(100-one2one/filtered*100);
//$(".one2one").html( ratio + "% collective meetings");
			}
	});

  }

	function drawCountry () {
	var dim = ndx.dimension (function(d) {
			return countries[d.contact_country][1];
	});

	var group   = dim.group().reduceSum(function(d) {   
			return 1; });

		var filteredGroup = (function(source_group) {
			return {
				all: function() {
					return source_group.top(10).filter(function(d) {
						return (d.key != "Not mentioned" && d.value != 0);
					});
				}
			};
      })(dim.group().reduceSum(function(d) {return 1; }));

		var graph = dc.rowChart(".country")   
			.margins({top: 0, right: 3, bottom: 20, left: 3})
			.height(340)
			//.width(300)
			.gap(2)
      		//.fixedBarHeight(20)
			.x(d3.scale.ordinal())
			.elasticX(true)
			.colorCalculator(function(d, i) {
				return "#ecb005";
			})
			.ordering(function(d){return -d.value})
			.dimension(dim)
			.group(filteredGroup);

	}



	function drawExpense () {
		var dim = ndx.dimension (function(d) {
      if (d.meetings + d.accredited)
        return d.id;
      return "";
	});

  var group   = dim.group().reduce(
      function(p,d) {  
        p.nb +=1;
        p.fte += +d.fte;
        p.accredited += +d.accredited;
        p.cost += +getCost(d);
        p.meetings += +d.meetings;
        return p;
      },
      function(p,d) {  
        p.nb -=1;
        p.fte += d.fte;
        p.accredited += +d.accredited;
        p.cost-= +getCost(d);
        p.meetings -= +d.meetings;
        return p;
      },
      function(p,d) {  
        return {nb:0,fte:0,accredited:0,cost:0, meetings:0}; 
      }
    )
    .order(function (p) {return p.nb});

	var graph = dc.bubbleChart (".expense")   
//		.colorCalculator(function(d, i) { return blue;})
		.width(750)
		.height(380)
		.margins({top: 20, right: 20, bottom: 20, left: 30})
		.yAxisLabel("Nb Meetings")
		.dimension(dim)
		.group(group)
		.keyAccessor(function (d) {
        return d.value.cost;
		})
		.valueAccessor(function (d) {
				return d.value.meetings;
		})
		.radiusValueAccessor(function (d) {
        if (d.value.fte  > 40) return 40;
				return d.value.fte;
		})
		.x(d3.scale.linear().domain([0, 10000000]))
		.y(d3.scale.linear().domain([0, 40]))
		.r(d3.scale.linear().domain([0, 1000]))
		.minRadiusWithLabel(5000)
/*
	var graph = dc.barChart (".expense")   
		.height(320)
		.width(530)
		.gap(0)
    .keyAccessor(function(d) { 
        return d.key[0]})
		  .margins({top: 10, right: 20, bottom: 200, left: 40})
		.x(d3.scale.linear().domain([0, 1000000]))
 //   .x(d3.scale.ordinal())
//    .xUnits(dc.units.ordinal)
		.elasticX(true)
		.elasticY(true)
				.brushOn(true)
		.yAxisLabel("Lobbying expense")
		.colorCalculator(function(d, i) {
				return "#f85631";
				})
		.dimension(dim)
		.group(group);
*/
		graph.xAxis().ticks(5).tickFormat(d3.format(",.0f"));

		graph.yAxis().ticks(3).tickFormat(d3.format(",.0f"));
	}

	
	function drawNbMeetings () {
		var dim = ndx.dimension (function(d) {
        if (d.meetings>4)
          return 5;
			  return d.meetings;
		});

		var group   = dim.group().reduceSum(function(d) {   return 1; });
		
		var color = d3.scale.ordinal()
		    .range(["#f9e5ad", "#f1ca58","#ecb007","#e7960e","#e37e17","#de631f"]);
		
		var chart = dc.pieChart(".meetings")
			.innerRadius(50).radius(100)
			.height(200)
			.label(function(d){ 
          	if (d.key == 5)
            	return ">5";
          	return d.key })
			.title (function(d){ 
         		switch(d.key) {
           			case 0:
             			return "no meeting";
           			case 1:
             			return d.key + " meeting: " + d.value;
            	 	break;
           			case 5:
             			return ">5 meetings: " + d.value;
             		break;
           				default:
             		return d.key + " meetings: " + d.value;
         		}
       		})
			.dimension(dim)
			.colorCalculator(function(d, i) {
				return color(d.key);
			})
			.group(group);
	}

	function drawNbBadges () {
		var dim = ndx.dimension (function(d) {
        if (!d.accredited) return 0;
        if (d.accredited>4)
          return 5;
			  return d.accredited;
		});

		var group   = dim.group().reduceSum(function(d) {   return 1; });
		
		var color = d3.scale.ordinal()
		    .range(["#f9e5ad", "#f1ca58","#ecb007","#e7960e","#e37e17","#de631f"]);
					
		var chart = dc.pieChart(".accreditations")
			.innerRadius(50).radius(100)
			.height(200)
			.label(function(d){ 
	          if (d.key == 5)
	            return ">5";
	          return d.key })
				.title (function(d){ 
	         switch(d.key) {
	           case 0:
	             return "no accreditation";
	           case 1:
	             return d.key + " accreditation: " + d.value;
	             break;
	           case 5:
	             return ">5 accreditations: " + d.value;
	             break;
	           default:
	             return d.key + " accreditations: " + d.value;
	         }
       })
			.dimension(dim)
			.colorCalculator(function(d, i) {
				return color(d.key);
			})
			.group(group);
	}

	function drawNbLobbyists () {
		var dim = ndx.dimension (function(d) {
        if (d.fte>4)
          return 5;
			  return d.fte;
		});

		var group   = dim.group().reduceSum(function(d) {   return 1; });

		var chart = dc.pieChart(".nblobbyists")
			.innerRadius(50).radius(100)
			.height(200)
			.label(function(d){ 
          if (d.key == 5)
            return ">5";
          return d.key })
			.title (function(d){ 
         switch(d.key) {
           case 0:
             return "no staff";
           case 1:
             return d.key + " staff: " + d.value;
             break;
           case 5:
             return ">5 staff: " + d.value;
             break;
           default:
             return d.key + " staffs: " + d.value;
         }
       })
			.dimension(dim)
			.group(group);
	}

	function drawMainCategory () {
		var dim = ndx.dimension (function(d) {
			  return d.main_category;
		});

		var group   = dim.group().reduceSum(function(d) {   return 1; });
		
		var lobby_category_colors = { //please note that Think tanks and churches have an extra space at the end of the string
			"Corporate":"#cf270e",
			"Consultants":"#d74517",
			"Think tanks ":"#de6320",
			"Municipal":"#e58a13",
			"NGOs":"#ecb005",
			"Churches ":"#f6d882",
			
			"Not mentioned":"#808080",
			"Not registered":"#a6a6a6",
			"Unknown":"#cccccc",
			"Deregistered":"#f2f2f2"
		}
		
		var chart = dc.pieChart(".main_category")
			.innerRadius(50).radius(100)
			.height(200)
			.label(function(d){ return mainCategories[d.key] })
			.title (function(d){ return mainCategories[d.key] +" "+d.value })
			.colorCalculator(function(d, i) {
				//console.log(d)
				return lobby_category_colors[mainCategories[d.key]];
			})
			.dimension(dim)
			.group(group);
	}

	function drawSector () {
	var dim = ndx.dimension (function(d) {
			return d.sub_category;
	});

	var group   = dim.group().reduceSum(function(d) {   return 1; });
		/*
			 //return [representatives[d.guestid].main_category,representatives[d.guestid].main_category_title];
			 var t={};
			 group.all().forEach (function (d) {if (d.key[0]) t[d.key[0]]=d.key[1]})
			 JSON.stringify(t);
		*/
		
	var lobby_sector_colors = {	
		"Companies & groups":"#cf270e",//Corporate
		"Trade and business associations":"#cf270e",//Corporate
		"Other organisations":"#cf270e",//Corporate
		"Law firms":"#d74517",//Consultants
		"Professional consultancies":"#d74517",//Consultants
		"Self-employed consultants":"#d74517",//Consultants
		"Non-governmental organisations, platforms and networks and similar":"#ecb005",//NGOs
		"Think tanks and research institutions":"#de6320",//Think tanks
		"Academic institutions":"#de6320",//Think tanks
		"Organisations representing churches and religious communities":"#f6d882",//Churches
		"Local, regional and municipal authorities (at sub-national level)":"#e58a13",//Municipal
		"Other public or mixed entities, etc.":"#e58a13",//Municipal
		
		"Not mentioned":"#808080",
		"Not registered":"#a6a6a6",
		"Deregistered":"#cccccc",
		"Unknown":"#f2f2f2"
	}

	var graph = dc.rowChart (".sector")   
		.height(380)
		//.width(350)
		.gap(1)
		.margins({top: 0, right: 0, bottom: 0, left: 0})
		.x(d3.scale.ordinal())
			.label(function(d){ return subCategories[d.key] })
			.title (function(d){ return subCategories[d.key] +" "+d.value })
		.elasticX(true)
		.colorCalculator(function(d, i) {
			if (d.key == "Not mentioned" || d.key == "Unknown" || d.key == "Not registered")
				return "#cccccc";
			return "#ecb005";
		})
		.dimension(dim)
		.group(group)
		.xAxis().ticks(4).tickFormat(d3.format(",.0f"));

	}




	function drawTable () {
		var count=0;
    //id,contact_country,sub_category,acronym,name,main_category,cost_min,cost_max,cost_absolute

    datatable = $(".table").dataTable({
            "columnDefs": [ {
              "defaultContent":"",
              "orderable": false,
              "targets": 0,   
              data: function ( row, type, val, meta ) {
                count++;
                return count;
              }
              },{
              "searchable": false,
              "orderable": true,
              "targets": 1,
              data: function (row, type, val, meta) { 
                if (row.acronym) 
                  return row.name+" ("+row.acronym +" )";
                return row.name;
                }
              //data: "name",  
              },{
              "searchable": false,
              "orderable": true,
              "type":"num-fmt",
              "targets": 2,
              "className": "number",
              "render": function ( data, type, row ) { 
                if (data == "")
                  return 0;
                  //return "<10k";
                return d3.format(",g")(data);
              },
              data: function (row, type, val, meta) { return getCost(row)}
              },{
              "defaultContent":"AA",
              "searchable": false,
              "orderable": true,
              "targets": 3,
              data: "meetings",  
              },{
              "defaultContent":"AA",
              "searchable": false,
              "orderable": true,
              "targets": 4,
              data: "fte",  
              },{
              "defaultContent":"AA",
              "searchable": false,
              "orderable": true,
              "targets": 5,
              data: "accredited",  
              } 
            ],
            "iDisplayLength" : 100,
            "bPaginate": true,
            "bLengthChange": false,
            "bFilter": false,
            "order": [[ 3, "desc" ]],
            "bSort": true,
            "bInfo": false,
            "bAutoWidth": false,
            "bDeferRender": true,
            "aaData": rep.top(Infinity),
            "bDestroy": true,
        });

    function format (d) {
      var s="<div>More details on:";
      if (!d.code)
        return "Data missing to display";
      s += '<div class="btn-group" qdata-toggle="buttons">';
      s += "<button class='btn btn-sm btn-primary' data-type='event'>Events</button>";
      s += "<button class='btn btn-sm btn-primary' data-type='accreditation'>Accreditations</button>";
      s += "<button class='btn btn-sm btn-primary' data-type='financial_data'>Financial declarations</button>";
      s += "<button class='btn btn-sm btn-primary' data-type='representative'>Details</button>";
      s += "<a href='http://ec.europa.eu/transparencyregister/public/consultation/displaylobbyist.do?id="+d.code+"' class='btn btn-sm' target='_blank'>Transparency registry</a>";
      return s+"</div></div>"+"<pre>"+JSON.stringify(d,null,2)+"</pre>";
    }

    datatable.on('click', 'button', function () {
        var tr = $(this).closest('tr');
        var type=$(this).data("type");
        var pre=$(this).parent().parent().next("pre");
        var row = datatable.DataTable().row( tr.prev()[0] );
        var d=row.data();
     
        if (type == "event") {
            var sevents =[];
            _.each(events,function (e){
            if (e.guestid == d.id)
              sevents.push(e);
            });
            pre.html(JSON.stringify(sevents,null,2));
            return;
        }

        var r= (tr.data("representative"));
        if (!r) {
          url="http://api.lobbyfacts.eu/api/1/representative/"+d.id+"?callback=?";
          $.getJSON( url, function( data ) {
            tr.data("representative",data);
            display (data);
          });
          return;
        }
        display(r,type);

        function display (data) {
          switch (type) {
            case "financial_data":
             pre.html(JSON.stringify(data["financial_data"],null,2));
              break;
            case "accreditation":
             pre.html(JSON.stringify(data["accreditations"],null,2));
              break;
            default:
              pre.html(JSON.stringify(data,null,2));
          }
        }
        
    } );
    datatable.on('click', 'tr[role="row"]', function () {
        var tr = $(this);
        var row = datatable.DataTable().row( tr );
 
        if ( row.child.isShown() ) {
            // This row is already open - close it
            row.child.hide();
            tr.removeClass('shown');
        }
        else {
            // Open this row
            row.child( format(row.data()) ).show();
            tr.addClass('shown');
        }
    } );
        datatable.on( 'order.dt search.dt', function () {
          datatable.DataTable().column(0, {search:'applied', order:'applied'}).nodes().each( function (cell, i) {
            cell.innerHTML = i+1;
          } );

        });

	}

       function RefreshTable() {
            dc.events.trigger(function () {
                alldata = rep.top(Infinity);
                datatable.fnClearTable();
                datatable.fnAddData(alldata);
                datatable.fnDraw();
            });
        }

		dc.renderAll();
		hashFilter();



}

function getCost (d) { 
  if (d.cost_absolute > 0)
    return +d.cost_absolute;
  return +d.cost_min;
} 

function hashFilter () {
	var hash = window.location.hash;

	 if(hash.indexOf('#mep') === 0) { 
		 eventpopup(hash.substring(4));
		 ga && ga('send', 'event', 'urlevent',hash.substring(4));
	 }
}
	 
function eventpopup (epid) {
			window.location.hash = "event"+d.epid;
			 ga && ga('send', 'event', 'clickevent',hash.substring(4));
			//$( "#twitter").html(tplTwitter(d));

}

</script>


<nav class="navbar navbar-default" role="navigation">
	<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<div class="navbar-brand" id="ti_logo_container">
						<a id="ti_logo" href="http://www.transparencyinternational.eu">Transparency International</a>
						<a id="page_title" href="/" target="_blank"><strong>EU</strong> Integrity<br />Watch</a>
				</div>
			</div>
		
			<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav">
					<li id="cm_tool_btn"><a href="ec.html"><strong>Commission</strong> <br />meetings</a></li>
					<li class="active" id="bl_tool_btn"><a href="lobbist.html"><strong>EU</strong><br />Lobbyists</a></li>
					<li id="mi_tool_btn"><a href="ep.html"><strong>MEP</strong> <br />incomes</a></li>
				</ul>
				<ul class="nav navbar-nav navbar-right">
					<li><a href="about.html">About</a></li>
				</ul>
			</div>
	 </div><!-- container -->
</nav>
<div class="container_wrap bl_header" id="about_wrap_top">&nbsp;</div>
<div class="container_wrap bl_header" id="about_wrap">
	<div class="container">
		<div id="about_container" class="row">
			<div class="col-md-3 col-lg-2" id="about_content_icon">
			</div>
			<div class="col-md-6 col-lg-7" id="about_content">
				<p>
					EU Integrity Watch is a user-friendly interactive database that provides a unique overview of the activities of the commissionners and cabinet members in the European Commission.members of the European Parliament.<br /><a href="about.html" class="more">Read more</a></p>
					<p>By simply clicking on the graphs or the list below users can rank, sort and filter events.</p>
			</div>
			<div class="col-md-3" id="about_social">
				<br/>
				<a href="https://twitter.com/share" class="twitter-share-button" data-via="TI_EU" data-text="Want to know #MEPs income & activities outside @Europarl_EN? Find out">Tweet</a>
				<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
				<br/>
				<br/>
				<div class="fb-like" data-show-faces="false"  data-href="http://www.integritywatch.eu/" data-layout="standard" data-action="like" data-show-faces="true" data-share="true"></div>

				<div id="fb-root"></div>
				<script>(function(d, s, id) {
					var js, fjs = d.getElementsByTagName(s)[0];
					if (d.getElementById(id)) return;
					js = d.createElement(s); js.id = id;
					js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1";
					fjs.parentNode.insertBefore(js, fjs);
				}(document, 'script', 'facebook-jssdk'));</script>

			</div>
		</div>
		
	</div><!-- container -->
</div>

<div class="container_wrap" id="toggle_about_wrap">
	<div class="container">
		<div class="row">
			<div class="col-xs-2 col-md-1 col-centered bl_collapse" id="collapse_about">
				<a class="opened" href="#">collapse</a>
			</div>
		</div>
	</div>
</div>

<div class="container_wrap filter_bl" id="filter_wrap">
	<div class="container">
		<div class="row">
			<div class="col-xs-9 col-sm-9 col-md-4" id="filter_field_container">
				<p>Search or filter:</p>
				<div class="input-group">
						<input type="text" id="search-input" class="form-control input-lg" placeholder="Filter by Lobbyist, Host, Subjectâ€¦">
				</div>
			</div>
			<div class="col-sm-7 col-md-7" id="filter_numbers">
				<div class="row">
					<div class="col-md-2" id="currently_selected_text"><p>Currently selected:</p></div>
					<div class="col-md-3 filter_number">
<<<<<<< HEAD
						<div id="mep_number" class="dc-data-count org-count">
							<span id="abig_number" class="big_number filter-count"></span>out of <strong class="total-count"></strong> organisations
=======
						<div id="mep_number" class="dc-data-count">
							<span id="abig_number" class="big_number filter-count"></span>out of <strong class="total-count"></strong><br />organisations
>>>>>>> 49368e33d6fdf33da9383123b0d51a6ceb3c9256
						</div>
					</div>
					<div class="col-md-4 filter_number">
            <div title="full time equivalent"><span class="afilter_long nbfte"></span> Lobbyists</div>
            <div title="full time equivalent"><span class="afilter_long nbcost"></span> Lobby budget</div>
            <div title="access badges to the European Parliament"><span class="afilter_long nbaccredited">BB</span> EP badges</div>
					</div>
				</div>
			</div>
			<div class="col-xs-3 col-sm-3 col-md-1" id="resetall_container">
				<button class="btn resetall">RESET<br />FILTERS</button>
			</div>
		</div>
	</div>
</div>

<div id="ec">
	<div class="container_wrap" id="main_charts_wrap">
		<div class="container">
			<div class="row">
				<div class="col-md-3 chart_box">
					<h3>Top 10 Countries</h3>
					<div class="country">
					</div>
					<br class="clear" />
					<div class="label">Number of meetings</div>
				</div>
				<div class="col-md-3 chart_box" id="hosttype">
					<h3>Accreditation<!--span class="info">info</span--></h3>
					<div class="accreditations"></div>
					<br class="clear" />
				</div>
				<div class="col-md-3 chart_box">
					<h3>Number of meetings</h3>
					<div class="meetings">
					</div>
				</div>
				<div class="col-md-3 chart_box">
					<h3>Category of Lobby organisation</h3>
					<div class="main_category"></div>
					<div class="legend">
						<div class="corporate">Corporate</div>
						<div class="consultants">Consultants</div>
						<div class="think">Think Tanks</div>
						<div class="municipal">Municipal</div>
						<div class="ngos">NGOs</div>
						<div class="churches">Churches</div>
						<div class="not_mentioned">Not mentioned</div>
						<div class="not_registered">Not registered</div>
						<div class="unknown">Unknown</div>
						<div class="deregistered">Deregistered</div>
						<br class="clear" />
					</div>
					<br class="clear" />
				</div>
			</div>
			<div class="row">
				<!--<div class="col-md-3 chart_box">
					<h3>Portfolio</h3>
					<div class="host range chart-full"></div>
					<br class="clear" />
				</div>-->
				<div class="col-md-8 chart_box">
					<h3>Lobbying expense</h3>
					<div class="expense">
					</div>
				</div>
				<div class="col-md-4 chart_box">
					<h3>Sector of Lobby organisation<!--span class="info">info</span--></h3>
					<div class="sector range chart-full"></div>
					<br class="clear" />
				</div>
			</div>
			<div class="row">
				<div class="col-md-12 chart_box">
					<h3>Date</h3>
					<div class="date">
					</div>
				</div>
			</div>
		</div>
	</div>	
</div>


<div class="container_wrap" id="list_container">
	<div class="container">
		<div class="row">
			<div class="content" id="list_content">
				<h2 class="table_title">Registered Lobbyists</h2><div id="last_update">Last updated: 11 March 2015</div>
			</div>
			
				<table class="table table-hover dc-data-grid tablesorter-bootstrap">
					<thead>
						<tr class=header>
							<th class="header col-md-1">Nr</th> 
							<th class="header col-md-5">Name</th> 
							<th class="header">Lobby Budget</th> 
							<th class="header">Meetings</th> 
							<th class="header">Lobbyists</th> 
							<th class="header">EP badges</th> 
						</tr>
					</thead>
				</table>
			</div>
		</div>
	</div>
</div>

<script>
'use strict';
	var events=[];
	var representatives={};
  var countries={};

	$(function() {
		var renderLoaded  = _.after(3,  function () { 
			//var dateFormat = d3.time.format("%d/%m/%Y");
			var dateFormat = d3.time.format("%Y-%m-%d");
			var now = Date.now();
			var a;

			_.each (events, function (d) {
        if (!d.guestid)
          return;
        if (ridx[d.guestid]) {
          representatives[ridx[d.guestid]].meetings +=1;
        }
				d.date=dateFormat.parse(d.date);
				if (!d.cabinet) 
					return;
				if (d.cabinet.substr(19)=="Cabinet member of ")
					d.cabinet = d.cabinet.substr(19);
			});
			grid ("#ec",representatives);
		});
		d3.csv("data/country.csv", function(d) {return d;}
			,function(error, rows) {
         _.each(rows, function(d) {
           countries[d["id"]] = [d["code"],d["name"]];
         });
				 renderLoaded();
			});      
		d3.csv("data/meeting_flat.csv", function(d) {return d;}
			,function(error, rows) {
				 events = rows;
				 renderLoaded();
			});      
		//d3.json("data/representative-light.json", function (rows) {
		//d3.csv("data/representative.csv", function (rows) {
    d3.csv("data/r.csv", function(d) {return d;}
      ,function (rows) {
        representatives = rows;
				 _.each (representatives, function (d,i) {
						//representatives[d.identification_code]=d;
            ridx[d.id]=i;
						d.meetings=0;
			});
				 renderLoaded();
		});     

	$("#search-input").keyup (function () {
		var s = $(this ).val().toLowerCase();
		rep.filter(function (d) { 
			return d.indexOf (s) !== -1;} );
		$(".resetall").attr("disabled",false);
		throttle();
//        dc.redrawAll();

		var throttleTimer;
		function throttle() {
			window.clearTimeout(throttleTimer);
			throttleTimer = window.setTimeout(function() {
					dc.redrawAll();
			}, 250);
		}
	});

	$(".resetall").click(function() {
		$("#search-input").val("");
		$(".resetall").attr("disabled",true);
		dc.filterAll();
		dc.renderAll();

	});

 
});      

</script>



<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-55613514-1', 'auto');
	ga('send', 'pdateview');

</script>
</body>
</html>
