<html lang="en" dir="ltr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>EU Integrity Watch</title>
<link rel="shortcut icon" href="favicon.ico">
<link rel="stylesheet" type="text/css" href="css/dc.css"/>
<!--link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet"-->
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/material.css" rel="stylesheet">
<link href="css/theme.bootstrap.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="css/style.css"/>


<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the pdate via file:// -->
<!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

<!--script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.11/crossfilter.min.js"></script>
<script type="text/javascript" src="js/dc.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js"></script>
<script src="js/d3-tip.min.js"></script-->

<script src="js/jquery.min.js"></script>
<script src="js/jquery.tablesorter.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/d3.js" charset="utf-8"></script>
<script type="text/javascript" src="js/crossfilter.js"></script>
<script type="text/javascript" src="js/dc.js"></script>
<script type="text/javascript" src="js/underscore-min.js"></script>
<script src="js/d3-tip.min.js"></script>

<script src="js/jquery.min.js"></script>
<script src="js/jquery.tablesorter.min.js"></script>
<script src="js/bootstrap.min.js"></script>

<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@TI_EU" />
<meta name="twitter:creator" content="@eucampaign" />

<meta property="og:url" content="http://www.integritywatch.eu" />
<meta property="og:title" content="EU Integrity Watch: monitor potential conflicts of interests" />
<meta property="og:description" content="Interactive database that provides a unique overview of the activities and outside income for the members of the European Parliament and Commission" />
<meta property="og:imdate" content="http://www.integritywatch.eu/img/thumbnail.jpg" />

</head>
<body>


<script>
$( document ).ready(function() {
	$('#view_charts').click(function(ev) {
		ev.preventDefault();
		$('#hidden_charts_wrap').slideToggle('slow', function () {
			changeLinkStatus();
		})
	})
	
	function changeLinkStatus() {
		if($('#hidden_charts_wrap').css('display') == 'none'){
			$('#view_charts').text('VIEW ALL THE CHARTS')
		}else {
			$('#view_charts').text('HIDE CHARTS')
		}
		$('#view_charts').toggleClass('hiddencharts');
	}
	
	$('#collapse_about a').click(function(ev) {
		ev.preventDefault();
		$('#collapse_about a').toggleClass('opened');
		$('#about_wrap').slideToggle('slow', function () {
			
		})
	})
	
	$('.info').click(function(ev) {
		ev.preventDefault();
		if($(this).hasClass('opened')){
			$(this).removeClass('opened');
			$(this).parents('.info_chart').find('p.desc').slideUp('fast')
		}else{
			closeAllInfos();
			$(this).addClass('opened');
			$(this).parents('.info_chart').find('p.desc').slideDown('fast')
		}
	});
	
	function closeAllInfos() {
		$('.info').removeClass('opened');
		$('p.desc').slideUp('fast');
	}
	
});

$.tablesorter.addParser({
  // use a unique id
  id: 'amount',
  is: function(s, table, cell) {
    return false;
  },
  format: function(s, table, cell, cellIndex) {
    var v = s.split(' ')[0];
    if (v === "") return -1;
    return v;
  },
  // flag for filter widget (true = ALWAYS search parsed values; false = search cell text)
  parsed: false,
  // set the type to either numeric or text (text uses a natural sort function
  // so it will work for everything, but numeric is faster for numbers
  type: 'numeric'
});

var detailtpl = sidetpl = null ;

var wall = null;


function grid (selector,data) {

  var ndx = crossfilter(data),
      all = ndx.groupAll();

  var color = d3.scale.linear()
        .clamp(true)
        .domain([0,1, 70])
        .range(["white","#ffc7b6", "#f85631"])
        .interpolate(d3.interpolateHcl);



  dc.dataCount(".dc-data-count")
    .dimension(ndx)
    .group(all);

  dc.dataCount(".dc-data-count2")
    .dimension(ndx)
    .group(all);


  var name = ndx.dimension(function(d) {
        return d.title.toLowerCase();
      });

  drawTable();
  drawDate();
  drawWeekDay();
/*  drawScore();
  drawParty();
  drawRange();
*/
  function drawTable () {
    var i=0;
    wall=dc.dataTable(".dc-data-grid")
     .dimension(name)
      .group(function (d) { return "";return d.country; })
      .columns([
          function(d) { i=i+1; return i; },
          function(d) {  return d.host; },
          function(d) {
              return d.date;
          },
          function(d) {  return d.title; },
          function(d) {  return d.guestname; },
          function(d) {  return d.location; },
      ])
    .size(1000)
    .sortBy(function (d) {return d.date})
    .renderlet(function (chart) {
      i = 0;
      $(".dc-table-group").remove();
      $("td:first-child").each (function(i) { 
        $(this).closest ("td").css("backgroundColor", 
          $(this).css('backgroundColor')
        );
      });
      $("td span.score").each (function(i) { 
        $(this).closest ("td").css("backgroundColor", 
          $(this).css('backgroundColor')
        );
      });
      $("table.dc-data-grid").trigger("update");
    });
  }

    dc.renderAll();
    hashFilter();

     $("table.dc-data-grid").tablesorter(
        {theme:"bootstrap",headers: {}}
     ).bind("sortEnd",function(e, table) {
      ga && ga('send', 'event', 'sort','table');
      var i=0;
      $("td:first-child").each (function(){this.innerHTML=++i;});
    });
     

function drawRange () {
	
	/*colors
	"#ffffff",
	"#f8e8e5",
	"#f9d1c8",
	"#f9a896",
	"#fb8065",
	"#f85631"
	*/
 
  function getRange (d) {
    if (d.score === 0 ) return ". None"; 
    if (d.min < 500 ) return "0. < 500"; 
    if (d.min < 1001 ) return "1. < 1000"; 
    if (d.min < 5001 ) return "2. < 5000"; 
    if (d.min < 10001 ) return "3. < 10000"; 
    return "4. 10000 or more";
  };

  var color = d3.scale.ordinal()
  	  //blue->orange//.range(["#3695d8", "#5989b3", "#857c93", "#ae6e74", "#d76155", "#ff523a"]);
      .range(["#FFFFFF", "#8ed3fb", "#68add4", "#4388ad", "#1a6287", "#003c60"]);
        
  var dimension = ndx.dimension(function(d) {
    return getRange(d);
  });

  var group   = dimension.group().reduceSum(function(d) { return 1; });
  var chart = dc.pieChart(selector +  " .range")
    .innerRadius(50).radius(100)
    .height(200)
    .colors(color)
    .colorAccessor(function (d, i){return i;})
    .dimension(dimension)
    .group(group);
}

function drawParty () {
  var bubble_party = dc.bubbleChart(" .party");
  var party = ndx.dimension(function(d) {
      if (typeof d.party == "undefined") return "";
      return d.party;
      });
   var tip = d3.tip()
    .attr('class', 'd3-tip')
    .html(function(p) { return '<span><h2>' +
        p.key + "</h2><ul>" + 
                "<li>Number of events: " +p.value.count + "</li>" +
                "<li>Averdate participation: " +Math.floor (p.value.effort/p.value.count) + "</li>" +
                "<li>Averdate score: "+Math.floor (p.value.score/p.value.count); 
       '</li></ul></span>' })
    .offset([-12, 0])


  var partyGroup   = party.group().reduce(
      function(a,d) {a.eugroup = d.eugroup;a.count +=1; a.score +=d.score; a.effort += d.attendance.score; return a; },
      function(a,d) {a.eugroup = d.eugroup;a.count -=1; a.score -=d.score; a.effort -= d.attendance.score; return a; },
      function() {return {eurgroup:0,count:0,score:0,effort:0}; }
      )
      .order(function (p) {return p.count});
  bubble_party
    .colorCalculator(function(d, i) {
      return eu_groups[d.value.eugroup];
    })
  .valueAccessor (
      function(d) {
      return d.value.count;
      })
  .width(660)
    .height(300)
    .margins({top: 20, right: 20, bottom: 20, left: 30})
    .yAxisLabel("%Votes attended")
    .dimension(party)
    .group(partyGroup)
    .keyAccessor(function (p) {
        return p.value.score/p.value.count;
    })
    .valueAccessor(function (p) {
        return p.value.effort/p.value.count;
    })
    .radiusValueAccessor(function (p) {
        return p.value.count;
    })
    .x(d3.scale.linear().domain([0, 60]))
    .r(d3.scale.linear().domain([0, 100]))
    .minRadiusWithLabel(150)
}

function drawDate() {
  var chart_date = dc.lineChart(selector + " .date");

 var date = ndx.dimension(function(d) {
      if (typeof d.date == "undefined") return "";
      return d.date;
      });


  var dateGroup   = date.group().reduceSum(function(d) {   return 1; });

  chart_date
    .height(300)
    .width (430)
    .margins({top: 0, right: 20, bottom: 20, left: 30})
        .x(d3.time.scale().domain([new Date(2014, 11, 1), new Date(2015, 11, 31)]))
        .round(d3.time.month.round)
        .xUnits(d3.time.months)

    .brushOn(true)
    .renderArea(true)
    .elasticY(true)
    .yAxisLabel("Number of meetings")
    .dimension(date)
    .group(dateGroup);
}

function drawWeekDay() {
    var graph=dc.rowChart('.day-of-week-chart');
    // counts per weekday
    var dayOfWeek = ndx.dimension(function (d) {
        if (d.date == null) return "Unknown";
        var day = d.date.getDay();
        var name = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        return day + '.' + name[day];
    });
    var dayOfWeekGroup = dayOfWeek.group();

    
    graph.width(180)
        .height(180)
        .margins({top: 20, left: 10, right: 10, bottom: 20})
        .group(dayOfWeekGroup)
        .dimension(dayOfWeek)
        // assign colors to each value in the x scale domain
        .ordinalColors(['#3182bd', '#6baed6', '#9ecae1', '#c6dbef', '#dadaeb'])
        .label(function (d) {
            return d.key.split('.')[1];
        })
        // title sets the row text
        .title(function (d) {
            return d.value;
        })
        .elasticX(true)
        .xAxis().ticks(4);

}

function drawScore() {

  var score = ndx.dimension (function(d) {
      return d.score;
      });
  var scoreGroup   = score.group().reduce(
      function(a,d) {a.count +=1; a.score +=d.score; a.min =d.min; a.max = d.max;return a; },
      function(a,d) {a.count -=1; a.score -=d.score; a.min =d.min; a.max = d.max; return a; },
      function() {return {count:0,score:0, min:0, max:0}; }
      );

  var bar_score = dc.barChart (".bar_score")   
    .height(220)
    .width(330)
    .gap(0)
    .margins({top: 10, right: 20, bottom: 20, left: 40})
    .x(d3.scale.linear().domain([0, 70]))
    .elasticX(true)
    .elasticY(true)
    .yAxisLabel("Number of events")
    .round(dc.round.floor)
    .colorCalculator(function(d, i) {
        return "#f85631";
        })
    .valueAccessor (
      function(d) {
      return d.value.count;
      })
    .dimension(score)
    .group(scoreGroup)
    .renderlet(function (chart) {
//      var d = chart.group().top(Number.POSITIVE_INFINITY);
      var total = nb = min = max = 0;
      var d = chart.dimension().top(Number.POSITIVE_INFINITY);
      d.forEach (function (a) {
        if (isNaN(a.score)) return;
        ++nb;
        total += a.score;
        min += a.min;
        max += a.max;
      });
      if (nb) {
        var avg= total/nb;
        $("div#avg_score").text(Math.round(avg));
        $("div#sum_side").html("Total "+ Math.round(min)+" &euro;");
        $("div#avg_side").html("Averdate "+Math.round(min/nb)+ " &euro;");
      } else {
        $("div#avg_score").text("");
      }
    //why doesn't it work? if (chart.dimension().size() !== chart.group().value()) {
      if (ndx.size() !== nb) {
        $(".resetall").attr("disabled",false);
        ga && ga('send', 'event', 'filter', 'subset', nb);
      } else {
        $(".resetall").attr("disabled",true);
        ga && ga('send', 'event', 'filter', 'reset');
      }
      
  });
  bar_score.yAxis().ticks(4).tickFormat(d3.format(",.0f"));
}


}

  function getAmountString(d) {
          if (d.qty == 0) {
            return "";
          }
          if (d.max == Number.POSITIVE_INFINITY)
            return "<span class='q"+d.qty+"' title='"+d.qty.length+" different occupations'>"+d.min+" &euro; or more</span>";
          return d.min +" &#8605; "+d.max +"  &euro;";
  }

  function getAmount (category, field) { //field = min (default) or max or "string"
    field = field || "min";
    if (!category) return "?";
    if (isNaN(category)) return category;
    if (category < 0 && field == "min") return "0";
    if (category < 0 && field == "max") return "499";
    if (category < 0 && field == "string") return "0  &#8605; 499 &euro;";
     
    if (category >=4 && field == "max") return "or more";
    if (category >=4 && field == "string") return rangeEUR[category]["min"] + " or more";
    if (field == "string")
      return  rangeEUR[category]["min"] + " &#8605; "+  rangeEUR[category]["max"];
    return rangeEUR[category][field];
  }

function hashFilter () {
  var hash = window.location.hash;

   if(hash.indexOf('#mep') === 0) { 
     eventpopup(hash.substring(4));
     ga && ga('send', 'event', 'urlevent',hash.substring(4));
   }
}
   
function eventpopup (epid) {
      window.location.hash = "event"+d.epid;
       ga && ga('send', 'event', 'clickevent',hash.substring(4));
      //$( "#twitter").html(tplTwitter(d));

}

</script>


<nav class="navbar navbar-default" role="navigation">
	<div class="container">
    	<div class="navbar-header">
      		<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        		<span class="sr-only">Toggle navigation</span>
        		<span class="icon-bar"></span>
        		<span class="icon-bar"></span>
        		<span class="icon-bar"></span>
      		</button>
	      	<div class="navbar-brand" id="ti_logo">
	      		<a href="http://www.transparencyinternational.eu">Transparency International</a>
	     	</div>
	    </div>
    
    	<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
	    	<ul class="nav navbar-nav" id="title_container">
	    	    <li><a id="pdate_title" href="/" target="_blank"><strong>EU</strong> Integrity Watch</a></li>
	    	</ul>
	        <ul class="nav navbar-nav navbar-right">
	            <li><a href="about.html">About</a></li>
	            <li><a href="contact.html">Contact</a></li>
	    	</ul>
    	</div>
   </div><!-- container -->
</nav>

<div class="container_wrap" id="about_wrap">
	<div class="container">
		<div id="about_container" class="row">
			<div class="col-md-9" id="about_content">
				<p>
EU Integrity Watch is a user-friendly interactive database that provides a unique overview of the activities of members of the European Parliament. By simply clicking on the graphs or the list below users can rank, sort and filter events. Thereby the database allows to better monitor potential conflicts of interests or to identify those events with more outside activities with the help of the External Activity Indicator (EAI)
<br/>
				<a href="about.html" class="more">Read more</a>
				</p>
			</div>
			<div class="col-md-3" id="about_social">

<br/>
<a href="https://twitter.com/share" class="twitter-share-button" data-via="TI_EU" data-text="Want to know #events income & activities outside @Europarl_EN? Find out">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
<br/>
<br/>
<div class="fb-like" data-show-faces="false"  data-href="http://www.integritywatch.eu/" data-layout="standard" data-action="like" data-show-faces="true" data-share="true"></div>

 <div id="fb-root"></div>
  <script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));</script>

</p>
      </div>
		</div>
		
	</div><!-- container -->
</div>
<div class="container_wrap" id="toggle_about_wrap">
	<div class="container">
		<div class="row">
			<div class="col-xs-2 col-md-1 col-centered" id="collapse_about">
				<a class="opened" href="#">collapse</a>
			</div>
		</div>
	</div>
</div>

<div class="container_wrap" id="filter_wrap">
	<div class="container">
		<div class="row">
			<div class="col-sm-7" id="filter_field_container">
			 	<p>Filter the results by selecting a range in the charts,
			 	or by filling the filter box:</p>
			 	<div class="input-group">
			 	    <input type="text" id="search-input" class="form-control input-lg" placeholder="filter by event name, national party, EP committee...">
			 	</div>
			 	<button class="btn resetall">RESET ALL FILTERS</button>
			</div>
			<div class="col-sm-5 col-md-4 col-md-offset-1" id="filter_mep_number">
				<p>You have currently selected</p>
				<div id="mep_number" class="dc-data-count">
					<span id="big_number" class="filter-count"></span>/<strong class="total-count"></strong> events
				</div>
			</div>
		</div>
	</div>
</div>

<div id="ec">
	<div class="container_wrap" id="main_charts_wrap">
		<div class="container">
			<h2>Charts</h2>
			<div class="row">
				<div class="col-md-6 chart_box">
					<h3>Host<!--span class="info">info</span--></h3>
					<div class="host"></div>
					<br class="clear" />
				</div>
				<div class="col-md-3 chart_box" id="group_container">
					<h3>Day of weeks <!--span class="info">info</span--></h3>
					<div class="day-of-week-chart">
					</div>
					<br class="clear" />
				</div>
				<div class="col-md-3 chart_box">
					<h3>Sector</h3>

					<div class="sector range">
					</div>
					
					<br class="clear" />
				</div>
			</div>
			<a href="#" id="view_charts" class="hiddencharts">VIEW ALL THE CHARTS</a>
		</div>
		
	</div>
	
	<div class="container_wrap" id="ihidden_charts_wrap">
		<div class="container">
			<div class="row">
				<div class="col-md-5 chart_box frontpdate_score">
				    <div class="dc-data-count">
				        <h3>Date</h3>
				        <div id="avg_score_container">
				        <div class="bar_score">
				        </div>
				    </div>
				    <br class="clear" />
				</div>
				
				<div class="col-md-4 chart_box">
					<h3>Location</h3>
					<div class="interest"></div>
					<br class="clear" />
				</div>
				
				<div class="col-md-3">
					<h3>Gender</h3>
					<div class="gender">
					</div>
					<br class="clear" />
				</div>
			</div>
			<div class="row">
				<div class="col-md-7 chart_box">
					<h3>Cabinet?</h3>
					
					<div class="party">
					</div>
					
					<br class="clear" />
				</div>
				<div class="col-md-5 chart_box">
					<h3>Date</h3>
					<div class="date">
					</div>
					<br class="clear" />
				</div>
			</div>
		</div>
	</div>
</div>


<div class="container_wrap" id="list_container">
	<div class="container">
		<div class="row">
			<div class="content" id="list_content">
				<h2>Meetings in the commission</h2>
				<div class="info_chart" id="attendance_info">
					<span class="info">info</span>
					<p class="desc">Events</p>
				</div>
				
				<div class="info_chart" id="EAI_info">
					<span class="info">info</span>
					<p class="desc">The External Activity Indicator was developed by Transparency International EU to provide a quick overview of all outside activities of members of the European Parliament. In short, the higher the indicator the higher the outside income and number of outside activities of a member. A higher EAI is reflected in a darker shading of orange. <br /><a href="about.html#methodology">More details</a></p>
				</div>
				
				<div class="info_chart" id="OI_info">
					<span class="info">info</span>
					<p class="desc">Total monthly income declared by the member in the Declaration of Financial Interests</p>
				</div>
			</div>
			
			<div class="col-md-12 table-responsive">
				<table class="table table-hover dc-data-grid tablesorter-bootstrap">
					<thead>
						<tr class=header>
							<th class="headerSortDown">Nr</th> 
							<th>Name</th> 
							<th>date</th> 
              <th>Title</th> 
							<th>With</th> 
              <th>Location</th> 
						</tr>
					</thead>
				</table>
			</div>
		</div>
		
		<div id="last_update">Last updated: 11 March 2015</div>
	</div>
</div>

<script>
'use strict';
  var events=[];
  var representatives=[];
  $(function() {
    var renderLoaded  = _.after(2,  function () { 
      var dateFormat = d3.time.format("%d/%m/%Y");
      var now = Date.now();
      var a;

      _.each (events, function (d) {
        d.date=dateFormat.parse(d.date);
 
      });
      grid ("#ec",events);
    });
    d3.tsv("data/meeting.tsv", function(d) {return d;}
      ,function(error, rows) {
         events = rows;
         renderLoaded();
      });      
    d3.json("data/representative.json", function (rows) {
         representatives = rows;
         renderLoaded();
    });     

  $("#search-input").keyup (function () {
    var s = $(this ).val().toLowerCase();
    wall.dimension().filter(function (d) { 
      return d.indexOf (s) !== -1;} );
    $(".resetall").attr("disabled",true);
    dc.redrawAll();
  });

  $(".resetall").click(function() {
    $("#search-input").val("");
    $(".resetall").attr("disabled",false);
    dc.filterAll();
    dc.renderAll();

  });

 
});      

</script>



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55613514-1', 'auto');
  ga('send', 'pdateview');

</script>
</body>
</html>
